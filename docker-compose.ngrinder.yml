# 사용법 요약
# 1) 최초 실행 전 볼륨 디렉터리를 생성합니다.
#    mkdir -p module-infrastructure/ngrinder/controller
#    mkdir -p module-infrastructure/ngrinder/agent
# 2) 컨트롤러/에이전트를 기동합니다.
#    docker compose -f docker-compose.ngrinder.yml up -d
# 3) 브라우저에서 http://<서버 IP>:16001 접속 후 웹 콘솔 사용
# 4) 중지 시 docker compose -f docker-compose.ngrinder.yml down
#
# 포트 정보
# - 16001: 컨트롤러 웹 콘솔 (HTTP)
# - 16010: 컨트롤러-에이전트 제어 포트 (TCP)
#
# 주의사항
# - 에이전트를 추가하려면 아래 ngrinder-agent 블록을 복제하여 container_name만 변경하세요.
# - 컨트롤러 호스트명은 docker 네트워크 안에서 "ngrinder-controller"로 접근합니다.

services:
  ngrinder-controller:
    image: ngrinder/controller:3.5.9
    container_name: ngrinder-controller
    restart: unless-stopped
    ports:
      - "16001:16001"   # nGrinder 웹 콘솔 (HTTP)
      - "16010:16010"   # 에이전트 제어 포트
    environment:
      - TZ=Asia/Seoul
      - NGRINDER_HOME=/opt/ngrinder-controller
    volumes:
      - ./module-infrastructure/ngrinder/controller:/opt/ngrinder-controller
    networks:
      - ngrinder_network

  ngrinder-agent:
    image: ngrinder/agent:3.5.9
    container_name: ngrinder-agent
    restart: unless-stopped
    depends_on:
      - ngrinder-controller
    environment:
      - TZ=Asia/Seoul
    command: ["-c", "ngrinder-controller", "-p", "16001", "-r", "local"]
    volumes:
      - ./module-infrastructure/ngrinder/agent:/opt/ngrinder-agent
    networks:
      - ngrinder_network

networks:
  ngrinder_network:
    driver: bridge